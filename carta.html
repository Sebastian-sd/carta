<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carta Villa Grill • Pedidos</title>
  <style>
    :root{--bg:#0b1220;--card:#0f172a;--muted:#94a3b8;--text:#e5e7eb;--brand:#22c55e;--border:#213043}
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1220,#0a0f1a);color:var(--text);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Arial}
    header{position:sticky;top:0;z-index:10;display:flex;gap:12px;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border);backdrop-filter:saturate(1.2) blur(6px);background:#0b1220cc}
    h1{font-size:clamp(18px,3.5vw,22px);margin:0;font-weight:800}
    .container{max-width:1100px;margin:0 auto;padding:14px}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:16px}
    .card{background:linear-gradient(180deg,#0e1628,#0b1220);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 24px #00000055}
    .section{padding:12px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .toolbar input[type="search"], .toolbar input[type="text"], select{border:1px solid var(--border);background:#0b1220;color:var(--text);border-radius:12px;padding:10px 12px;outline:none}
    .badge{padding:4px 10px;border:1px solid var(--border);border-radius:999px;color:#a5b4fc;background:#0b1220}
    .list{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px}
    .item{border:1px solid var(--border);border-radius:14px;padding:10px;background:linear-gradient(180deg,#0c1425,#0b1220);display:grid;gap:8px}
    .item h3{margin:0;font-size:16px}
    .price{color:#93c5fd;font-weight:700}
    button{appearance:none;border:1px solid #1e293b;border-radius:10px;background:linear-gradient(180deg,#16a34a,#22c55e);color:#06240f;font-weight:800;padding:10px 12px;cursor:pointer}
    .ghost{background:#0b1220;color:#cbd5e1;border:1px dashed #334155}
    .cart{display:grid;gap:10px}
    .cart h2{margin:0 0 6px 0;font-size:18px}
    .row{display:flex;gap:8px;align-items:center}
    .kvs{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .total{display:flex;align-items:center;justify-content:space-between;border-top:1px dashed var(--border);padding-top:8px;margin-top:6px}
    small.muted{color:var(--muted)}
    #registro{max-height:300px;overflow:auto;margin-top:16px;padding:6px;border:1px solid var(--border);border-radius:10px;background:#0e1628}
    #registro .pedido{border-bottom:1px solid #1f2937;padding:6px 0}
    @media (max-width:960px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<header>
  <h1>Villa Grill • Pedidos</h1>
  <span class="badge" id="status">Desconectado</span>
</header>

<div class="container grid">
  <!-- IZQUIERDA: CARTA -->
  <section class="card section">
    <div class="toolbar">
      <input id="buscar" type="search" placeholder="Buscar (ej. hamburguesa, parrilla, salchipapas)" />
      <select id="categoria">
        <option value="">Todas las categorías</option>
        <option value="parrillas">Parrillas</option>
        <option value="hamburguesas">Hamburguesas</option>
        <option value="salchipapas">Salchipapas</option>
      </select>
      <span class="badge" id="itemsCount">0 ítems</span>
    </div>

    <div id="menu" class="list" style="margin-top:12px"></div>
    <small class="muted">* Toca «Personalizar» para elegir cremas, tipo de papas y ensalada en Hamburguesas y Salchipapas.</small>
  </section>

  <!-- DERECHA: CARRITO / CLIENTE -->
  <aside class="card section">
    <div class="cart">
      <h2>Carrito</h2>
      <div id="carritoVacio" class="row"><small class="muted">Aún no hay productos. Agrega de la carta →</small></div>
      <div id="carrito"></div>
      <div class="kvs" style="margin-top:8px">
        <input id="cliente" type="text" placeholder="Nombre del cliente" />
        <select id="pago">
          <option value="pendiente">Por pagar</option>
          <option value="pagado">Pagado</option>
        </select>
      </div>
      <div class="total">
        <strong>Total: <span id="total">S/ 0.00</span></strong>
        <button id="enviar">Enviar pedido</button>
      </div>
      <small class="muted">Los pedidos se guardan en Firebase Realtime Database.</small>
    </div>
  </aside>
</div>

<!-- Registro del día -->
<section class="container card section" style="margin-top:12px">
  <h2 style="margin:0 0 8px 0">Registro de pedidos (hoy)</h2>
  <div id="registro" class="list" style="grid-template-columns:1fr; gap:8px"></div>
</section>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  const firebaseConfig = {
  apiKey: "AIzaSyC3w6KUZi0bKdSMP2f2M3ele8dLtCGpVLk",
  authDomain: "parrillas-66b0e.firebaseapp.com",
  databaseURL: "https://parrillas-66b0e-default-rtdb.firebaseio.com",
  projectId: "parrillas-66b0e",
  storageBucket: "parrillas-66b0e.firebasestorage.app",
  messagingSenderId: "520361790818",
  appId: "1:520361790818:web:36b65573eabde389c9f03b",
  measurementId: "G-79700DWFFW"
};
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const $ = s=>document.querySelector(s);
  const menuEl=$('#menu'),buscarEl=$('#buscar'),catEl=$('#categoria'),itemsCount=$('#itemsCount');
  const carritoEl=$('#carrito'),carritoVacio=$('#carritoVacio'),totalEl=$('#total'),enviarBtn=$('#enviar');
  const status=$('#status'),registroEl=$('#registro');

  const CARTA=[
    {id:'hamb_carne',cat:'hamburguesas',nombre:'Hamburguesa de Carne',precio:10,desc:'Carne, papas y ensalada',opciones:{cremas:['mayonesa','ketchup','mostaza','ají','tarí','golf'],papas:['hilo','frita'],ensalada:['lechuga','tomate','completo','sin ensalada']}},
    {id:'hamb_royal_carne',cat:'hamburguesas',nombre:'Hamburguesa Royal Carne',precio:13,desc:'Carne, huevo, queso, papas y ensalada',opciones:{cremas:['mayonesa','ketchup','mostaza','ají','tarí','golf'],papas:['hilo','frita'],ensalada:['lechuga','tomate','completo','sin ensalada']}},
    {id:'hamb_filete_pollo',cat:'hamburguesas',nombre:'Hamburguesa Filete de Pollo',precio:10,desc:'Filete de pollo, papas y ensalada',opciones:{cremas:['mayonesa','ketchup','mostaza','ají','tarí','golf'],papas:['hilo','frita'],ensalada:['lechuga','tomate','completo','sin ensalada']}},
    {id:'hamb_royal_pollo',cat:'hamburguesas',nombre:'Hamburguesa Royal Pollo',precio:13,desc:'Filete de pollo, huevo, queso, papas y ensalada',opciones:{cremas:['mayonesa','ketchup','mostaza','ají','tarí','golf'],papas:['hilo','frita'],ensalada:['lechuga','tomate','completo','sin ensalada']}},
    {id:'hamb_chorizo',cat:'hamburguesas',nombre:'Hamburguesa de Chorizo',precio:9,desc:'Chorizo, papas y ensalada',opciones:{cremas:['mayonesa','ketchup','mostaza','ají','tarí','golf'],papas:['hilo','frita'],ensalada:['lechuga','tomate','completo','sin ensalada']}},
    {id:'hamb_cordero',cat:'hamburguesas',nombre:'Hamburguesa de Cordero',precio:13,desc:'Cordero, papas y ensalada',opciones:{cremas:['mayonesa','ketchup','mostaza','ají','tarí','golf'],papas:['hilo','frita'],ensalada:['lechuga','tomate','completo','sin ensalada']}},
    {id:'salchi_clasica',cat:'salchipapas',nombre:'Salchipapa clásica / ahumadas',precio:10,desc:'Papa y HotDog',opciones:{cremas:['mayonesa','ketchup','mostaza','ají','tarí','golf'],papas:['hilo','frita'],ensalada:['lechuga','tomate','completo','sin ensalada']}},
    {id:'parr_cerdo',cat:'parrillas',nombre:'Parrillada de Cerdo',precio:27,desc:'2 presas, choclo, ensalada, chorizo'},
    {id:'parr_res',cat:'parrillas',nombre:'Parrillada de Res',precio:27,desc:'2 presas, choclo, ensalada, chorizo'},
    {id:'parr_pollo',cat:'parrillas',nombre:'Parrillada de Pollo',precio:27,desc:'2 presas, choclo, ensalada, chorizo'},
    {id:'parr_cordero',cat:'parrillas',nombre:'Parrillada de Cordero',precio:27,desc:'2 presas, choclo, ensalada, chorizo'},
    {id:'costillar_cordero',cat:'parrillas',nombre:'Costillar de Cordero',precio:36,desc:'6 tiras, choclo, ensalada, chorizo'}
  ];

  const cart=[];

  function pintarMenu(){
    const q=(buscarEl.value||'').toLowerCase();const cat=catEl.value;
    const data=CARTA.filter(x=>(!cat||x.cat===cat)&&(x.nombre.toLowerCase().includes(q)||x.cat.includes(q)));
    itemsCount.textContent=`${data.length} ítems`;
    menuEl.innerHTML=data.map(x=>`<div class=item><div class=row style="justify-content:space-between"><h3>${x.nombre}</h3><span class=price>S/ ${x.precio.toFixed(2)}</span></div>${x.desc?`<small class=muted>${x.desc}</small>`:''}${x.opciones?'<small class=muted>Incluye opciones</small>':'<small class=muted>Solo cantidad</small>'}<div class=row><button data-id=${x.id} class=add>Agregar</button><button data-id=${x.id} class="custom ghost">Personalizar</button></div></div>`).join('');
    menuEl.querySelectorAll('button.add').forEach(b=>b.onclick=()=>agregar(b.dataset.id));
    menuEl.querySelectorAll('button.custom').forEach(b=>b.onclick=()=>personalizar(b.dataset.id));
  }

  function agregar(id,custom={}){
    const it=CARTA.find(i=>i.id===id);
    // en lugar de qty acumulado, agregamos items unitarios
    cart.push({id:it.id,nombre:it.nombre,precio:it.precio,cremas:custom.cremas||null,papas:custom.papas||null,ensalada:custom.ensalada||null,ts:Date.now()});
    pintarCarrito();
  }

  function personalizar(id){
    const it=CARTA.find(i=>i.id===id);
    if(!it.opciones){agregar(id);return;}
    const cremas=prompt('Cremas (coma separadas)','mayonesa,ketchup');
    const papas=prompt('Tipo papas (hilo/frita)','hilo');
    const ensalada=prompt('Ensalada (lechuga,tomate,completo,sin ensalada)','completo');
    agregar(id,{cremas:cremas.split(',').map(s=>s.trim()),papas,ensalada});
  }

  function pintarCarrito(){
    carritoEl.innerHTML='';
    if(cart.length===0){carritoVacio.style.display='block';}else{carritoVacio.style.display='none';}
    let suma=0;
    cart.forEach((l,i)=>{
      suma+=l.precio;
      const div=document.createElement('div');div.className='item';
      div.innerHTML=`<div class=row style="justify-content:space-between"><strong>${l.nombre}</strong><span class=price>S/ ${l.precio.toFixed(2)}</span></div>${l.cremas?`<small class=muted>Cremas:${l.cremas.join(',')} · Papas:${l.papas} · Ensalada:${l.ensalada}</small>`:''}<div class=row><button class=ghost data-i=${i} data-act=del style="margin-left:auto">Eliminar</button></div>`;
      carritoEl.appendChild(div);
    });
    totalEl.textContent=`S/ ${suma.toFixed(2)}`;
    carritoEl.querySelectorAll('button').forEach(b=>{const i=+b.dataset.i;const act=b.dataset.act;if(isNaN(i))return;b.onclick=()=>{if(act==='del')cart.splice(i,1);pintarCarrito();}})
  }

  enviarBtn.onclick=async()=>{
    if(cart.length===0){alert('Agrega productos');return;}
    const cliente=$('#cliente').value.trim();
    const pago=$('#pago').value;
    const pedido={cliente:cliente||null,pago,items:cart,total:cart.reduce((a,b)=>a+b.precio,0),ts:Date.now()};
    try{enviarBtn.disabled=true;await push(ref(db,'pedidos'),pedido);cart.length=0;pintarCarrito();alert('✅ Pedido enviado');}catch(e){alert('Error:'+e.message);}finally{enviarBtn.disabled=false;}
  };

  onChildAdded(ref(db,'pedidos'),snap=>{
    status.textContent='Conectado';
    const p=snap.val();
    const d=new Date(p.ts);
    const div=document.createElement('div');div.className='pedido';
    const items=p.items.map(i=>`${i.nombre}`).join(' • ');
    div.innerHTML=`<strong>${p.cliente||'Sin nombre'}</strong> - ${p.pago}<br>${items}<br>Total: S/ ${p.total.toFixed(2)} <small class=muted>${d.toLocaleString()}</small>`;
    registroEl.prepend(div);
  });

  buscarEl.oninput=pintarMenu;catEl.onchange=pintarMenu;
  pintarMenu();pintarCarrito();
</script>
</body>
</html>
